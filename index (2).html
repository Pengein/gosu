<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ë‚˜ëŠ” ê³ ìˆ˜ë¥¼ êµ¬ë¶„í•  ìˆ˜ ìˆì„ê¹Œ? ğŸ¤”</title>

<style>
  html, body {
    margin: 0; padding: 0; height: 100%; width: 100%;
    display: flex; justify-content: center; align-items: center;
    background-color: #2c3e50;
    font-family: 'Noto Sans KR', sans-serif;
    color: #ecf0f1;
    overflow: hidden;
    transition: background-color 0.3s ease;
  }

  /* ë‹¤í¬ëª¨ë“œ */
  body.dark-mode {
    background-color: #1a1a2e;
    color: #f0f0f0;
  }
  body.dark-mode #startScreen,
  body.dark-mode #quizGameContainer,
  body.dark-mode #gameOverScreen,
  body.dark-mode #optionsScreen,
  body.dark-mode #patchNotesModal {
    background-color: #1f2041;
    box-shadow: 0 10px 25px rgba(0,0,0,0.6);
  }
  body.dark-mode .menu-button,
  body.dark-mode .option-button {
    background-color: #4b4b7c;
  }
  body.dark-mode .menu-button:hover,
  body.dark-mode .option-button:hover {
    background-color: #6a6a9b;
  }
  body.dark-mode #restartButton {
    background-color: #be392a;
  }
  body.dark-mode #restartButton:hover {
    background-color: #a02c1f;
  }
  body.dark-mode #nextButton {
    background-color: #d1871a;
  }
  body.dark-mode #nextButton:hover {
    background-color: #b97615;
  }

  /* ì‹œì‘ í™”ë©´ */
  #startScreen {
    background-color: #34495e;
    border-radius: 20px;
    box-shadow: 0 10px 25px rgba(0,0,0,0.4);
    padding: 40px 60px;
    width: 90%;
    max-width: 1200px;
    height: 90%;
    max-height: 600px;
    box-sizing: border-box;
    text-align: center;
    margin: 0 auto;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    transition: background-color 0.3s ease, box-shadow 0.3s ease;
  }

  #startScreen h1 {
    font-family: 'Jua', sans-serif;
    color: #f1c40f;
    font-size: 3em;
    margin-bottom: 30px;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    white-space: pre-line;
  }

  .menu-buttons-container {
    display: flex;
    flex-direction: column;
    gap: 15px;
    width: 70%;
    max-width: 550px;
    margin: 0 auto;
    box-sizing: border-box;
  }

  .menu-button {
    background-color: #673ab7;
    color: white;
    padding: 18px 35px;
    border: none;
    border-radius: 12px;
    font-size: 1.8em;
    cursor: pointer;
    transition: background-color 0.2s ease, transform 0.2s ease, box-shadow 0.2s ease;
    box-shadow: 2px 2px 5px rgba(0,0,0,0.2);
    width: 100%;
  }
  .menu-button:hover {
    background-color: #512da8;
    transform: translateY(-3px);
  }
  .menu-button:active {
    transform: translateY(0);
  }

  /* í€´ì¦ˆ ê²Œì„ ì»¨í…Œì´ë„ˆ */
  #quizGameContainer {
    background-color: #34495e;
    border-radius: 20px;
    box-shadow: 0 10px 25px rgba(0,0,0,0.4);
    padding: 40px;
    text-align: center;
    width: 90%;
    max-width: 800px;
    box-sizing: border-box;
    opacity: 0;
    transform: translateY(20px);
    transition: opacity 0.5s ease-out, transform 0.5s ease-out, background-color 0.3s ease, box-shadow 0.3s ease;
    display: none;
    min-height: 500px;
    flex-direction: column;
    align-items: center;
    justify-content: flex-start;
  }

  /* ìœ íŠœë¸Œ í”Œë ˆì´ì–´ */
  #player-container {
    position: relative;
    width: 100%;
    padding-bottom: 56.25%;
    height: 0;
    overflow: hidden;
    margin-bottom: 30px;
    border-radius: 10px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.3);
  }
  #player {
    position: absolute;
    top: 0; left: 0;
    width: 100%;
    height: 100%;
    border-radius: 10px;
  }

  /* ë¡œë”© ìŠ¤í”¼ë„ˆ */
  #player-loading-spinner {
    position: absolute;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    border: 5px solid rgba(255,255,255,0.3);
    border-top: 5px solid #3498db;
    border-radius: 50%;
    width: 50px; height: 50px;
    animation: spin 1s linear infinite;
    display: none;
    z-index: 10;
  }
  @keyframes spin {
    0% { transform: translate(-50%, -50%) rotate(0deg);}
    100% { transform: translate(-50%, -50%) rotate(360deg);}
  }

  /* ì˜µì…˜ ì»¨í…Œì´ë„ˆ */
  #optionsContainer {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 12px;
    margin-top: 20px;
    width: 100%;
  }
  /* ì˜µì…˜ ë²„íŠ¼ */
  .option-button {
    background-color: #3f51b5;
    color: white;
    padding: 12px 20px;
    border: none;
    border-radius: 8px;
    font-size: 1.3em;
    cursor: pointer;
    transition: background-color 0.2s ease, transform 0.2s ease;
    flex-grow: 1;
    min-width: 120px;
    max-width: calc(33.333% - 12px);
    box-shadow: 2px 2px 5px rgba(0,0,0,0.2);
    box-sizing: border-box;
  }
  .option-button:hover {
    background-color: #303f9f;
    transform: translateY(-2px);
  }
  .option-button:active {
    transform: translateY(0);
  }

  /* í”¼ë“œë°± ë©”ì‹œì§€ */
  #feedbackMessage {
    margin-top: 25px;
    font-size: 1.6em;
    font-weight: bold;
    color: #e74c3c;
    min-height: 30px;
    opacity: 0;
    transition: opacity 0.3s ease;
  }
  #feedbackMessage.correct {
    color: #2ecc71;
  }
  body.color-blind-mode #feedbackMessage.correct {
    color: #007bff;
  }
  body.color-blind-mode #feedbackMessage.wrong {
    color: #ff7f00;
  }

  /* ë‹¤ìŒ ë²„íŠ¼ */
  #nextButton {
    background-color: #f39c12;
    color: white;
    padding: 15px 40px;
    border: none;
    border-radius: 10px;
    font-size: 1.8em;
    cursor: pointer;
    margin-top: 30px;
    transition: background-color 0.2s ease, transform 0.2s ease;
    box-shadow: 2px 2px 5px rgba(0,0,0,0.2);
    display: none;
  }
  #nextButton:hover {
    background-color: #e67e22;
    transform: translateY(-2px);
  }

  /* ì ìˆ˜ ë° ëª©ìˆ¨ í‘œì‹œ */
  #scoreLivesContainer {
      display: flex;
      justify-content: space-around;
      width: 100%;
      margin-top: 20px;
      font-size: 1.5em;
      font-weight: bold;
      color: #ecf0f1;
  }
  #scoreDisplay, #livesDisplay {
      min-width: 120px;
  }

  /* ê²Œì„ ì˜¤ë²„ í™”ë©´ */
  #gameOverScreen {
    display: none;
    background-color: #34495e;
    border-radius: 20px;
    box-shadow: 0 10px 25px rgba(0,0,0,0.4);
    padding: 40px;
    text-align: center;
    width: 90%;
    max-width: 800px;
    box-sizing: border-box;
    opacity: 0;
    transform: translateY(20px);
    transition: opacity 0.5s ease-out, transform 0.5s ease-out;
    min-height: 400px;
    flex-direction: column;
    justify-content: center;
    align-items: center;
  }
  #gameOverScreen h2 {
    font-family: 'Jua', sans-serif;
    color: #f1c40f;
    font-size: 3.5em;
    margin-bottom: 20px;
  }
  #finalScore {
    font-size: 2.5em;
    color: #2ecc71;
    margin-bottom: 30px;
    font-weight: bold;
  }
  #restartButton {
    background-color: #e74c3c;
    color: white;
    padding: 15px 40px;
    border: none;
    border-radius: 10px;
    font-size: 1.8em;
    cursor: pointer;
    transition: background-color 0.2s ease, transform 0.2s ease;
    box-shadow: 2px 2px 5px rgba(0,0,0,0.2);
  }
  #restartButton:hover {
    background-color: #c0392b;
    transform: translateY(-2px);
  }

  /* í™”ë©´ ë²ˆì©ì„ íš¨ê³¼ ì˜¤ë²„ë ˆì´ */
  #flashOverlay {
    position: fixed;
    top: 0; left: 0; width: 100%; height: 100%;
    z-index: 9999;
    pointer-events: none;
    opacity: 0;
  }
  @keyframes correctFlash {
    0% { background-color: rgba(0, 255, 0, 0); opacity: 0; }
    50% { background-color: rgba(0, 255, 0, 0.3); opacity: 1; }
    100% { background-color: rgba(0, 255, 0, 0); opacity: 0; }
  }
  @keyframes incorrectFlash {
    0% { background-color: rgba(255, 0, 0, 0); opacity: 0; }
    50% { background-color: rgba(255, 0, 0, 0.3); opacity: 1; }
    100% { background-color: rgba(255, 0, 0, 0); opacity: 0; }
  }
  .flash-correct-active { animation: correctFlash 0.3s ease-out forwards; }
  .flash-incorrect-active { animation: incorrectFlash 0.3s ease-out forwards; }

  /* ì˜µì…˜ í™”ë©´ ëª¨ë‹¬ */
  #optionsScreen {
    display: none;
    flex-direction: row; /* ê°€ë¡œë°°ì¹˜ */
    justify-content: space-around;
    align-items: flex-start;
    background-color: #34495e;
    border-radius: 20px;
    box-shadow: 0 10px 25px rgba(0,0,0,0.4);
    padding: 40px 60px;
    width: 90%;
    max-width: 900px;
    height: 90%;
    max-height: 500px;
    box-sizing: border-box;
    transition: background-color 0.3s ease, box-shadow 0.3s ease;
    gap: 40px;
  }
  #optionsScreen h2 {
    font-family: 'Jua', sans-serif;
    color: #f1c40f;
    font-size: 2.5em;
    margin-bottom: 30px;
    width: 100%;
    text-align: center;
  }
  .options-group {
    display: flex;
    flex-direction: column;
    width: 200px;
    min-width: 180px;
    align-items: flex-start;
  }
  .options-group label {
    font-size: 1.6em;
    margin-bottom: 15px;
    color: #ecf0f1;
    font-weight: bold;
    text-align: left;
    width: 100%;
  }
  .options-toggle-button {
    width: 100%;
    font-size: 1.6em;
    padding: 10px 0;
    margin-bottom: 10px;
    background-color: #3f51b5;
    color: white;
    border: none;
    border-radius: 10px;
    cursor: pointer;
    transition: background-color 0.2s ease, transform 0.2s ease;
    box-shadow: 2px 2px 5px rgba(0,0,0,0.2);
  }
  .options-toggle-button:hover {
    background-color: #303f9f;
    transform: translateY(-2px);
  }
  .options-toggle-button.active {
    background-color: #28a745;
    box-shadow: 3px 3px 7px rgba(40, 167, 69, 0.4);
  }
  body.dark-mode .options-toggle-button.active {
    background-color: #1e7e34;
  }
  #optionsCloseButton {
    background-color: #e74c3c;
    color: white;
    padding: 15px 40px;
    border: none;
    border-radius: 10px;
    font-size: 1.8em;
    cursor: pointer;
    transition: background-color 0.2s ease, transform 0.2s ease;
    box-shadow: 2px 2px 5px rgba(0,0,0,0.2);
    margin-top: auto;
  }
  #optionsCloseButton:hover {
    background-color: #c0392b;
    transform: translateY(-2px);
  }

  /* íŒ¨ì¹˜ë…¸íŠ¸ ëª¨ë‹¬ */
  #patchNotesModal {
    display: none;
    flex-direction: column;
    justify-content: flex-start;
    align-items: center;
    background-color: #34495e;
    border-radius: 20px;
    box-shadow: 0 10px 25px rgba(0,0,0,0.4);
    padding: 40px;
    width: 90%;
    max-width: 800px;
    height: 90%;
    max-height: 600px;
    box-sizing: border-box;
    transition: background-color 0.3s ease, box-shadow 0.3s ease;
  }
  #patchNotesModal h2 {
    font-family: 'Jua', sans-serif;
    color: #f1c40f;
    font-size: 2.5em;
    margin-bottom: 25px;
    text-align: center;
  }
  #patchNotesContent {
    width: 100%;
    flex-grow: 1;
    overflow-y: auto;
    padding-right: 10px;
    line-height: 1.8;
    text-align: left;
  }
  /* íŒ¨ì¹˜ë…¸íŠ¸ HTML ìš”ì†Œ ìŠ¤íƒ€ì¼ */
  #patchNotesContent h3 {
    color: #f1c40f;
    font-size: 1.5em;
    margin-top: 20px;
    margin-bottom: 5px;
    border-bottom: 2px solid #f1c40f;
    padding-bottom: 5px;
  }
  #patchNotesContent ul {
    list-style: none;
    padding-left: 0;
    margin: 0;
  }
  #patchNotesContent ul li {
    margin-bottom: 8px;
    position: relative;
    padding-left: 20px;
  }
  /* ë²„ì „ í—¤ë”© ìŠ¤íƒ€ì¼ (ìˆ˜ì •ë¨) */
  #patchNotesContent ul li.patch-version-heading {
      color: #6aabff; /* íŒŒë€ìƒ‰ìœ¼ë¡œ ë²„ì „ ê°•ì¡° */
      font-weight: bold;
      margin-top: 10px;
      margin-bottom: 5px;
  }
  #patchNotesContent ul li.patch-version-heading::before {
      content: 'â–¸'; /* í™”ì‚´í‘œ ë¶ˆë¦¿ */
      color: #6aabff;
      font-size: 1.2em;
      left: 0;
      top: -2px;
  }
  /* ì‹¤ì œ íŒ¨ì¹˜ ë‚´ìš© ì•„ì´í…œ */
  #patchNotesContent ul li.patch-note-item {
      font-size: 0.95em;
      padding-left: 25px; /* ë“¤ì—¬ì“°ê¸° */
      color: #ccc; /* ë‚´ìš© ê¸€ì”¨ìƒ‰ */
  }
  #patchNotesContent ul li.patch-note-item::before {
      content: 'â€¢';
      color: #2ecc71;
      font-size: 1em;
      left: 10px; /* ë¶ˆë¦¿ ìœ„ì¹˜ ì¡°ì • */
      top: 0px;
  }

  #patchNotesCloseButton {
    background-color: #607d8b;
    color: white;
    padding: 15px 40px;
    border: none;
    border-radius: 10px;
    font-size: 1.8em;
    cursor: pointer;
    transition: background-color 0.2s ease, transform 0.2s ease;
    box-shadow: 2px 2px 5px rgba(0,0,0,0.2);
    margin-top: 30px;
  }
  #patchNotesCloseButton:hover {
    background-color: #455a64;
    transform: translateY(-2px);
  }


  /* ë°˜ì‘í˜• ëª¨ë°”ì¼ */
  @media (max-width: 768px) {
    #startScreen h1 {
      font-size: 2.2em;
      margin-bottom: 20px;
    }
    .menu-buttons-container {
      width: 90%;
      gap: 10px;
    }
    .menu-button {
      font-size: 1.3em;
      padding: 15px 25px;
    }
    #quizGameContainer, #startScreen, #gameOverScreen, #optionsScreen, #patchNotesModal {
      padding: 20px;
    }
    #player-container {
      margin-bottom: 20px;
    }
    .option-button {
      font-size: 1.1em;
      padding: 10px 15px;
      min-width: 100px;
      max-width: calc(50% - 12px);
    }
    #feedbackMessage {
      font-size: 1.3em;
    }
    #nextButton, #restartButton, .options-toggle-button {
      font-size: 1.5em;
      padding: 12px 30px;
    }
    #gameOverScreen h2 {
      font-size: 2.5em;
    }
    #finalScore {
      font-size: 2em;
    }
    #scoreLivesContainer {
        font-size: 1.2em;
    }
    #optionsScreen {
      flex-direction: column !important;
      max-width: 600px !important;
      gap: 25px !important;
      padding: 40px 30px !important;
      height: 90% !important;
      max-height: 500px !important;
    }
    .options-group {
      width: 100% !important;
      align-items: center !important;
    }
    .options-group label {
      text-align: center !important;
    }
    .options-toggle-button {
      width: 80% !important;
      font-size: 1.5em !important;
    }
    /* íŒ¨ì¹˜ë…¸íŠ¸ ëª¨ë‹¬ ëª¨ë°”ì¼ ìµœì í™” */
    #patchNotesModal h2 {
      font-size: 2em;
      margin-bottom: 15px;
    }
    #patchNotesContent h3 {
      font-size: 1.3em;
      margin-top: 15px;
    }
  }

  @media (max-width: 480px) {
    .option-button {
      max-width: 100%;
    }
  }
</style>
</head>
<body>
  <!-- ì‹œì‘ í™”ë©´ -->
  <div id="startScreen">
    <h1>ë‚˜ëŠ” ê³ ìˆ˜ë¥¼ êµ¬ë¶„í•  ìˆ˜ ìˆì„ê¹Œ? ğŸ¤”</h1>
    <div class="menu-buttons-container">
      <button id="startButton" class="menu-button">ì‹œì‘ ğŸš€</button>
      <button id="optionsButton" class="menu-button">ì˜µì…˜ âš™ï¸</button>
      <button id="discordButton" class="menu-button">ë””ìŠ¤ì½”ë“œ ğŸ‘¾</button>
      <button id="patchNotesButton" class="menu-button">íŒ¨ì¹˜ë…¸íŠ¸ ğŸ“</button>
    </div>
  </div>

  <!-- í€´ì¦ˆ ê²Œì„ ì»¨í…Œì´ë„ˆ -->
  <div id="quizGameContainer">
    <div id="player-container"><div id="player"></div><div id="player-loading-spinner"></div></div>
    <div id="optionsContainer"></div>
    <div id="feedbackMessage"></div>
    <button id="nextButton">ë‹¤ìŒ â¡ï¸</button>
    <!-- í€´ì¦ˆ ì¤‘ ë©”ë‰´ë¡œ ëŒì•„ê°€ê¸° ë²„íŠ¼ -->
    <button id="returnToMenuBtn" class="menu-button" style="background-color: #607d8b; margin-top: 20px;">
        ë©”ë‰´ë¡œ ëŒì•„ê°€ê¸°
    </button>
    <div id="scoreLivesContainer">
      <div id="scoreDisplay">ì ìˆ˜: 0</div>
      <div id="livesDisplay">ëª©ìˆ¨: â¤ï¸â¤ï¸â¤ï¸</div>
    </div>
  </div>

  <!-- ê²Œì„ ì˜¤ë²„ í™”ë©´ -->
  <div id="gameOverScreen">
    <h2>ê²Œì„ ì¢…ë£Œ! ğŸ‰</h2>
    <div id="finalScore"> ìµœì¢… ì ìˆ˜: 0ì  </div>
    <button id="restartButton">ë‹¤ì‹œ ì‹œì‘í•˜ê¸° ğŸ”„</button>
  </div>

  <!-- í™”ë©´ ë²ˆì©ì´ëŠ” íš¨ê³¼ë¥¼ ìœ„í•œ ì˜¤ë²„ë ˆì´ -->
  <div id="flashOverlay"></div>

  <!-- ì˜µì…˜ ì„¤ì • í™”ë©´ -->
  <div id="optionsScreen">
    <h2>ì„¤ì • âš™ï¸</h2>
    <div class="options-group">
      <label for="darkModeToggle">ì•¼ê°„ ëª¨ë“œ</label>
      <button id="darkModeToggle" class="options-toggle-button">ë¹„í™œì„±í™”</button>
    </div>
    <div class="options-group">
      <label for="colorBlindModeToggle">ìƒ‰ë§¹ ëª¨ë“œ (ì •ë‹µ/ì˜¤ë‹µ ìƒ‰ìƒ)</label>
      <button id="colorBlindModeToggle" class="options-toggle-button">ë¹„í™œì„±í™”</button>
    </div>
    <div class="options-group">
      <label for="reduceMotionToggle">ê´‘ê³¼ë¯¼ì„± ë°œì‘ ë°©ì§€ ëª¨ë“œ (ë²ˆì©ì„ íš¨ê³¼ ì œê±°)</label>
      <button id="reduceMotionToggle" class="options-toggle-button">ë¹„í™œì„±í™”</button>
    </div>
    <button id="optionsCloseButton" class="menu-button">ë‹«ê¸°</button>
  </div>

  <!-- íŒ¨ì¹˜ë…¸íŠ¸ ëª¨ë‹¬ -->
  <div id="patchNotesModal">
    <h2>íŒ¨ì¹˜ë…¸íŠ¸ ğŸ“</h2>
    <div id="patchNotesContent">
      <!-- íŒ¨ì¹˜ë…¸íŠ¸ ë‚´ìš©ì´ JavaScriptì—ì„œ ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤. -->
    </div>
    <button id="patchNotesCloseButton" class="menu-button">ë‹«ê¸°</button>
  </div>

<script src="https://www.youtube.com/iframe_api"></script>
<script>
  let player;
  let isPlayerReady = false;
  let currentVideoEndTime = -1; // í˜„ì¬ ì¬ìƒ ì¤‘ì¸ ì˜ìƒì˜ ì¢…ë£Œ ì‹œê°„
  let videoEndInterval; // ì˜ìƒ ì¢…ë£Œë¥¼ ì²´í¬í•  ì¸í„°ë²Œ

  const categories = ["ì¼ë°˜", "4êµ°", "3êµ°", "2êµ°", "1êµ°", "ì£¼ë ¥", "ê°•ì£¼ë ¥", "ì„ ìˆ˜ê¸‰"];
  const MAX_LIVES = 5;

  // --- íŒ¨ì¹˜ë…¸íŠ¸ ë°ì´í„° (ì—¬ê¸°ì„œ ë‚´ìš© ê´€ë¦¬!) ---
  const patchNotesData = [
    {
      version: "1.0.8",
      date: "2025.08.15", // ê¸°ì¡´ 1.0.7ê³¼ ë™ì¼í•œ ë‚ ì§œ
      notes: [
        "íŒ¨ì¹˜ë…¸íŠ¸ ë‚ ì§œë³„ ë¬¶ìŒ ê¸°ëŠ¥ ê°œì„ : ì´ì œ ê°™ì€ ë‚ ì§œ íŒ¨ì¹˜ëŠ” í•œ ë²ˆì˜ í—¤ë”©ìœ¼ë¡œ í‘œì‹œë©ë‹ˆë‹¤.",
        "íŒ¨ì¹˜ë…¸íŠ¸ UI ê°œì„ : ë²„ì „ë³„ êµ¬ë¶„ ë° ë‚´ìš© ê°€ë…ì„± í–¥ìƒ"
      ]
    },
    {
      version: "1.0.7",
      date: "2025.08.15",
      notes: [
        "ê¸´ê¸‰ ê³µì§€ ê¸°ëŠ¥ ì œê±° (ì´ì œ ë¶ˆí•„ìš”í•œ ê¸°ëŠ¥ì€ ì‚­ì œ!)",
        "íŒ¨ì¹˜ë…¸íŠ¸ ë‚´ìš© JS ê´€ë¦¬ ë°©ì‹ìœ¼ë¡œ ì „í™˜: AIê°€ 'ë¯¸ë¦¬' ì‘ì„±í•´ì¤€ ë‚´ìš©ì„ ë³µë¶™í•˜ë©´ ë!",
        "íŒ¨ì¹˜ë…¸íŠ¸ ê´€ë¦¬ ë°©ì‹ ì•ˆë‚´: ë¤¼íŠ¼ ë“± í…ìŠ¤íŠ¸ ìƒì„± AIë¥¼ í™œìš©í•˜ë©´ ë” ì‰½ê²Œ ì‘ì„± ê°€ëŠ¥!"
      ]
    },
    {
      version: "1.0.6",
      date: "2025.08.14",
      notes: [
        "ìœ íŠœë¸Œ ì˜ìƒ íŠ¹ì • êµ¬ê°„ ì¬ìƒ ê¸°ëŠ¥ ì¶”ê°€ (ì‹œì‘/ì¢…ë£Œ ì‹œê°„ ì„¤ì • ê°€ëŠ¥)"
      ]
    },
    {
      version: "1.0.5",
      date: "2025.08.13",
      notes: [
        "íŒ¨ì¹˜ë…¸íŠ¸ ê¸°ëŠ¥ ì¶”ê°€: ì´ì œ ì´ í™”ë©´ì—ì„œ ì—…ë°ì´íŠ¸ ë‚´ì—­ í™•ì¸ ê°€ëŠ¥!",
        "í€´ì¦ˆ ì¤‘ 'ë©”ë‰´ë¡œ ëŒì•„ê°€ê¸°' ë²„íŠ¼ ì¶”ê°€: í™•ì¸ ì ˆì°¨ë¥¼ í†µí•´ ì‹¤ìˆ˜ ë°©ì§€",
        "ì˜µì…˜ UI ê°œì„ : PC í™˜ê²½ì—ì„œ ì„¤ì •ì°½ ê°€ë¡œë¡œ ë„“ê²Œ ì¬ë°°ì¹˜"
      ]
    },
    {
      version: "1.0.4",
      date: "2025.08.13",
      notes: [
        "ì ‘ê·¼ì„± ì˜µì…˜ ì¶”ê°€: ì•¼ê°„ ëª¨ë“œ, ìƒ‰ë§¹ ëª¨ë“œ, ê´‘ê³¼ë¯¼ì„± ë°œì‘ ë°©ì§€ ëª¨ë“œ (ë²ˆì©ì„ íš¨ê³¼ ì œê±°)",
        "ì„¤ì •ê°’ LocalStorageì— ì €ì¥: ì•± ì¢…ë£Œ í›„ì—ë„ ì„¤ì • ìœ ì§€"
      ]
    },
    {
      version: "1.0.3",
      date: "2025.08.12",
      notes: [
        "í€´ì¦ˆ ì •/ì˜¤ë‹µ ì‹œ í™”ë©´ ë²ˆì©ì„ íš¨ê³¼ ì¶”ê°€: ì‹œê°ì  í”¼ë“œë°± ê°•í™”",
        "ëª©ìˆ¨ ì‹œìŠ¤í…œ êµ¬í˜„: ì‹œì‘ 3ê°œ, í‹€ë¦¬ë©´ ì°¨ê°, 3ì—°ì† ì •ë‹µ ì‹œ 1ê°œ íšë“ (ìµœëŒ€ 5ê°œ)"
      ]
    },
    {
      version: "1.0.2",
      date: "2025.08.12",
      notes: [
        "ë©”ì¸ ë©”ë‰´ UI ë””ìì¸ ê°œì„ : ë²„íŠ¼ ê°„ê²© ë° ì „ì²´ì ì¸ ë„“ì´ ì¡°ì •",
        "ìœ íŠœë¸Œ ì˜ìƒ ê¸°ë°˜ í€´ì¦ˆ ì‹œìŠ¤í…œ êµ¬ì¶•: ë¬¸ì œì— ì˜ìƒ í¬í•¨"
      ]
    },
    {
      version: "1.0.1",
      date: "2025.08.11",
      notes: [
        "ì´ˆê¸° ë²„ì „ ì¶œì‹œ: 'ë‚˜ëŠ” ê³ ìˆ˜ë¥¼ êµ¬ë¶„í•  ìˆ˜ ìˆì„ê¹Œ?' í€´ì¦ˆ ê²Œì„ ì‹œì‘"
      ]
    }
  ];

  // ë¬¸ì œ ë°ì´í„° - ìœ íŠœë¸Œ ì˜ìƒ ID, ì •ë‹µ ë“±ê¸‰, ì‹œì‘/ì¢…ë£Œ ì‹œê°„
  const questions = [
{ youtubeId: "4wmi_guc8ZM", answerCategory: "ì£¼ë ¥"}, 
{ youtubeId: "HgdpVld1M60", answerCategory: "ì£¼ë ¥"}, 
{ youtubeId: "0i8UI6HmUUI", answerCategory: "2êµ°"}, 
{ youtubeId: "-Vb3_eAQddc", answerCategory: "3êµ°"}, 
{ youtubeId: "VDIEVttNMzY", answerCategory: "3êµ°"}, 
{ youtubeId: "go5t5sn7g4c", answerCategory: "3êµ°"}, 
{ youtubeId: "dzJTA_IqKRY", answerCategory: "1êµ°"}, 
{ youtubeId: "xGWyI1CRLOU", answerCategory: "2êµ°"}, 
{ youtubeId: "e1Q53xjKaCo", answerCategory: "1êµ°"}, 
{ youtubeId: "jc338Na84VA", answerCategory: "1êµ°"},    // ì—¬ê¸°ì— ë¬¸ì œë¥¼ ë” ì¶”ê°€í•  ìˆ˜ ìˆì–´!
    // { youtubeId: "ìƒˆë¡œìš´_ì˜ìƒ_ID", answerCategory: "ì •ë‹µ_ë“±ê¸‰", startTime: 0, endTime: 60 },
  ];

  let shuffledQuestions = []; // í˜„ì¬ ê²Œì„ ì„¸ì…˜ì˜ ë¬´ì‘ìœ„ ë¬¸ì œ ìˆœì„œë¥¼ ì €ì¥í•  ë°°ì—´

  let currentQuestionIndex = 0;
  let score = 0;
  let lives = 3;
  let consecutiveCorrectAnswers = 0;
  let selectedOptionIndex = null;

  const htmlBody = document.body;
  const startScreen = document.getElementById('startScreen');
  const quizGameContainer = document.getElementById('quizGameContainer');
  const gameOverScreen = document.getElementById('gameOverScreen');
  const optionsScreen = document.getElementById('optionsScreen');
  const patchNotesModal = document.getElementById('patchNotesModal');
  const startButton = document.getElementById('startButton');
  const optionsButton = document.getElementById('optionsButton');
  const discordButton = document.getElementById('discordButton');
  const patchNotesButton = document.getElementById('patchNotesButton');
  const playerLoadingSpinner = document.getElementById('player-loading-spinner');
  const optionsContainer = document.getElementById('optionsContainer');
  const feedbackMessage = document.getElementById('feedbackMessage');
  const nextButton = document.getElementById('nextButton');
  const scoreDisplay = document.getElementById('scoreDisplay');
  const livesDisplay = document.getElementById('livesDisplay');
  const finalScore = document.getElementById('finalScore');
  const restartButton = document.getElementById('restartButton');
  const flashOverlay = document.getElementById('flashOverlay');
  const returnToMenuBtn = document.getElementById('returnToMenuBtn');

  // ì˜µì…˜ í† ê¸€ ë²„íŠ¼ë“¤
  const darkModeToggle = document.getElementById('darkModeToggle');
  const colorBlindModeToggle = document.getElementById('colorBlindModeToggle');
  const reduceMotionToggle = document.getElementById('reduceMotionToggle');
  const optionsCloseButton = document.getElementById('optionsCloseButton');
  // ëª¨ë‹¬ ë‹«ê¸° ë²„íŠ¼ë“¤
  const patchNotesCloseButton = document.getElementById('patchNotesCloseButton');

  let settings = {
    darkMode: false,
    colorBlindMode: false,
    reduceMotion: false
  };

  // --- ì„¤ì • ê´€ë ¨ í•¨ìˆ˜ ---
  function loadSettings() {
    const savedSettings = JSON.parse(localStorage.getItem('gameSettings'));
    if (savedSettings) {
      settings = { ...settings, ...savedSettings };
    }
    applySettings();
  }

  function applySettings() {
    htmlBody.classList.toggle('dark-mode', settings.darkMode);
    darkModeToggle.textContent = settings.darkMode ? 'í™œì„±í™”' : 'ë¹„í™œì„±í™”';
    darkModeToggle.classList.toggle('active', settings.darkMode);

    htmlBody.classList.toggle('color-blind-mode', settings.colorBlindMode);
    colorBlindModeToggle.textContent = settings.colorBlindMode ? 'í™œì„±í™”' : 'ë¹„í™œì„±í™”';
    colorBlindModeToggle.classList.toggle('active', settings.colorBlindMode);

    htmlBody.classList.toggle('reduce-motion-mode', settings.reduceMotion);
    reduceMotionToggle.textContent = settings.reduceMotion ? 'í™œì„±í™”' : 'ë¹„í™œì„±í™”';
    reduceMotionToggle.classList.toggle('active', settings.reduceMotion);
  }

  function saveSettings() {
    localStorage.setItem('gameSettings', JSON.stringify(settings));
  }

  // --- í™”ë©´ ì „í™˜ ê´€ë ¨ í•¨ìˆ˜ ---
  function hideAllScreens() {
    startScreen.style.display = 'none';
    quizGameContainer.style.display = 'none';
    gameOverScreen.style.display = 'none';
    optionsScreen.style.display = 'none';
    patchNotesModal.style.display = 'none';
  }

  function showScreen(screenElement) {
    hideAllScreens();
    screenElement.style.display = 'flex';
    setTimeout(() => {
      screenElement.style.opacity = '1';
      screenElement.style.transform = 'translateY(0)';
    }, 100);
  }

  function openOptionsScreen() {
    showScreen(optionsScreen);
  }

  function closeOptionsScreen() {
    showScreen(startScreen);
  }

  function openPatchNotesScreen() {
    populatePatchNotes(); // íŒ¨ì¹˜ë…¸íŠ¸ ë‚´ìš© ë™ì  ìƒì„±
    showScreen(patchNotesModal);
  }

  function closePatchNotesScreen() {
    showScreen(startScreen);
  }

  // --- ìœ íŠœë¸Œ í”Œë ˆì´ì–´ ê´€ë ¨ í•¨ìˆ˜ ---
  function onYouTubeIframeAPIReady() {
    player = new YT.Player('player', {
      videoId: 'vBfPzVd0y1s', // ì´ˆê¸° ë¡œë“œí•  ë”ë¯¸ ì˜ìƒ ID (í•„ìˆ˜)
      playerVars: {
        'playsinline': 1,
        'autoplay': 0,
        'rel': 0,
        'controls': 1,
        'enablejsapi': 1
      },
      events: { onReady: onPlayerReady, onStateChange: onPlayerStateChange }
    });
  }

  function onPlayerReady() {
    isPlayerReady = true;
    playerLoadingSpinner.style.display = 'none';
  }

  function onPlayerStateChange(event) {
    if (event.data == YT.PlayerState.PLAYING) {
      playerLoadingSpinner.style.display = 'none';
      if (currentVideoEndTime !== -1) {
          videoEndInterval = setInterval(() => {
              if (player.getCurrentTime() >= currentVideoEndTime) {
                  player.pauseVideo();
                  clearInterval(videoEndInterval);
              }
          }, 100);
      }
    } else if (event.data == YT.PlayerState.BUFFERING) {
      playerLoadingSpinner.style.display = 'block';
      clearInterval(videoEndInterval);
    } else {
      clearInterval(videoEndInterval);
    }
  }

  // --- UI ì—…ë°ì´íŠ¸ í•¨ìˆ˜ ---
  function updateLivesDisplay() {
    let hearts = '';
    for (let i = 0; i < lives; i++) {
      hearts += 'â¤ï¸';
    }
    livesDisplay.innerHTML = `ëª©ìˆ¨: ${hearts}`;
  }

  function triggerFlash(type) {
    if (settings.reduceMotion) {
      flashOverlay.classList.remove('flash-correct-active', 'flash-incorrect-active');
      return;
    }
    flashOverlay.classList.remove('flash-correct-active', 'flash-incorrect-active');
    if (type === 'correct') {
      flashOverlay.classList.add('flash-correct-active');
    } else if (type === 'incorrect') {
      flashOverlay.classList.add('flash-incorrect-active');
    }
    setTimeout(() => {
      flashOverlay.classList.remove('flash-correct-active', 'flash-incorrect-active');
    }, 500);
  }

  // --- íŒ¨ì¹˜ë…¸íŠ¸ ë‚´ìš© ë™ì  ìƒì„± (ë‚ ì§œë³„ ë¬¶ìŒ ë° ë²„ì „ë³„ ì •ë ¬ ê°œì„ ) ---
  function populatePatchNotes() {
    const contentDiv = document.getElementById('patchNotesContent');
    contentDiv.innerHTML = '';

    const groupedByDate = {};
    patchNotesData.forEach(patch => {
        if (!groupedByDate[patch.date]) {
            groupedByDate[patch.date] = [];
        }
        groupedByDate[patch.date].push(patch);
    });

    const sortedDates = Object.keys(groupedByDate).sort((a, b) => {
        const dateA = new Date(a.replace(/\./g, '-'));
        const dateB = new Date(b.replace(/\./g, '-'));
        return dateB - dateA;
    });

    sortedDates.forEach(date => {
        const dateSection = document.createElement('div');
        dateSection.innerHTML = `<h3>${date}</h3>`;

        const ul = document.createElement('ul');
        groupedByDate[date].sort((a, b) => {
            const parseVersion = (v) => v.split('.').map(Number);
            const versionA = parseVersion(a.version);
            const versionB = parseVersion(b.version);
            for (let i = 0; i < Math.max(versionA.length, versionB.length); i++) {
                const numA = versionA[i] || 0;
                const numB = versionB[i] || 0;
                if (numA !== numB) return numB - numA;
            }
            return 0;
        }).forEach(patch => {
            const versionLi = document.createElement('li');
            versionLi.classList.add('patch-version-heading');
            versionLi.textContent = `v${patch.version}:`;
            ul.appendChild(versionLi);

            patch.notes.forEach(note => {
                const noteLi = document.createElement('li');
                noteLi.classList.add('patch-note-item');
                noteLi.textContent = note;
                ul.appendChild(noteLi);
            });
        });
        dateSection.appendChild(ul);
        contentDiv.appendChild(dateSection);
    });
  }

  // --- ë°°ì—´ ì„ê¸° í•¨ìˆ˜ (Fisher-Yates shuffle) ---
  function shuffleArray(array) {
      for (let i = array.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [array[i], array[j]] = [array[j], array[i]]; // ìš”ì†Œ êµí™˜
      }
      return array;
  }

  // --- ê²Œì„ ë¡œì§ í•¨ìˆ˜ ---
  function loadQuestion(index) {
    feedbackMessage.style.opacity = '0';
    nextButton.style.display = 'none';
    optionsContainer.innerHTML = '';
    selectedOptionIndex = null;
    clearInterval(videoEndInterval);

    if (index < shuffledQuestions.length) { // ì„ì¸ ë¬¸ì œ ë°°ì—´ ì‚¬ìš©
      const q = shuffledQuestions[index]; // ì„ì¸ ë¬¸ì œì—ì„œ ê°€ì ¸ì˜¤ê¸°
      if (isPlayerReady && player) {
          playerLoadingSpinner.style.display = 'block';
          player.loadVideoById({
              videoId: q.youtubeId,
              startSeconds: q.startTime || 0
          });
          currentVideoEndTime = q.endTime || -1;
      } else {
          console.error("YouTube Player is not ready yet.");
      }

      categories.forEach((category, i) => {
        const btn = document.createElement('button');
        btn.textContent = category;
        btn.classList.add('option-button');
        btn.addEventListener('click', () => selectOption(i));
        optionsContainer.appendChild(btn);
      });
    } else {
      showGameOverScreen();
    }
  }

  function selectOption(selectedIndex) {
    if (selectedOptionIndex !== null) return;
    if (player && player.getPlayerState() === YT.PlayerState.PLAYING) {
      player.pauseVideo();
    }
    clearInterval(videoEndInterval);

    selectedOptionIndex = selectedIndex;
    const currentQuestion = shuffledQuestions[currentQuestionIndex]; // ì„ì¸ ë¬¸ì œ ë°°ì—´ ì‚¬ìš©
    const correctIndex = categories.indexOf(currentQuestion.answerCategory);
    const optionButtons = document.querySelectorAll('.option-button');

    optionButtons.forEach(btn => btn.disabled = true);

    if (selectedIndex === correctIndex) {
      feedbackMessage.textContent = "ì •ë‹µ! ì—­ì‹œ ê³ ìˆ˜êµ° ğŸ˜";
      feedbackMessage.classList.remove('wrong');
      feedbackMessage.classList.add('correct');
      score++;
      scoreDisplay.textContent = `ì ìˆ˜: ${score}`;
      consecutiveCorrectAnswers++;
      triggerFlash('correct');

      if (consecutiveCorrectAnswers === 3) {
        if (lives < MAX_LIVES) {
          lives++;
          feedbackMessage.textContent += " ëª©ìˆ¨ 1ê°œ íšë“! ğŸ‰";
        } else {
          feedbackMessage.textContent += " ëª©ìˆ¨ ìµœëŒ€ì¹˜! ğŸ’ª";
        }
        consecutiveCorrectAnswers = 0;
      }
    } else {
      feedbackMessage.textContent = "ì•„ì‰½ì§€ë§Œ í‹€ë ¸ì–´ ğŸ˜¥ ì¢€ ë” ê³ ìˆ˜ì˜ ê¸¸ì„ ê±·ì!";
      feedbackMessage.classList.remove('correct');
      feedbackMessage.classList.add('wrong');

      optionButtons[correctIndex].style.backgroundColor = '#2ecc71';
      optionButtons[selectedIndex].style.backgroundColor = '#e74c3c';

      lives--;
      consecutiveCorrectAnswers = 0;
      triggerFlash('incorrect');

      if (lives <= 0) {
        feedbackMessage.textContent += " ëª©ìˆ¨ ì†Œì§„! ğŸ’€";
        updateLivesDisplay();
        setTimeout(() => showGameOverScreen(), 1000);
        return;
      }
    }
    updateLivesDisplay();
    feedbackMessage.style.opacity = '1';
    nextButton.style.display = 'block';
  }

  function showGameOverScreen() {
    quizGameContainer.style.opacity = '0';
    quizGameContainer.style.transform = 'translateY(-20px)';
    if (player) player.stopVideo();
    clearInterval(videoEndInterval);
    setTimeout(() => {
      quizGameContainer.style.display = 'none';
      showScreen(gameOverScreen);
    }, 500);
    finalScore.textContent = `ìµœì¢… ì ìˆ˜: ${score}ì `;
  }

  // --- ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ---
  startButton.addEventListener('click', () => {
    hideAllScreens();
    showScreen(quizGameContainer);
    resetGameState(); // ê²Œì„ ì‹œì‘ ì‹œ ìƒíƒœ ì´ˆê¸°í™” ë° ë¬¸ì œ ì„ê¸°
    loadQuestion(currentQuestionIndex);
  });

  optionsButton.addEventListener('click', openOptionsScreen);
  discordButton.addEventListener('click', () => {
    const discordLink = 'https://discord.gg/nYWExhkYeG'; // TODO: ë””ìŠ¤ì½”ë“œ ë§í¬ ì„¤ì •!
    alert('ë””ìŠ¤ì½”ë“œ ì»¤ë®¤ë‹ˆí‹°ë¡œ ì´ë™í• ê²Œ!');
    window.open(discordLink, '_blank');
  });
  patchNotesButton.addEventListener('click', openPatchNotesScreen);

  darkModeToggle.addEventListener('click', () => {
    settings.darkMode = !settings.darkMode;
    applySettings();
    saveSettings();
  });
  colorBlindModeToggle.addEventListener('click', () => {
    settings.colorBlindMode = !settings.colorBlindMode;
    applySettings();
    saveSettings();
  });
  reduceMotionToggle.addEventListener('click', () => {
    settings.reduceMotion = !settings.reduceMotion;
    applySettings();
    saveSettings();
  });
  optionsCloseButton.addEventListener('click', closeOptionsScreen);
  patchNotesCloseButton.addEventListener('click', closePatchNotesScreen);

  nextButton.addEventListener('click', () => {
    currentQuestionIndex++;
    loadQuestion(currentQuestionIndex);
  });

  // ê²Œì„ ì¬ì‹œì‘ ë° ë©”ë‰´ ëŒì•„ê°€ê¸° ë¡œì§ (resetGameStateë¡œ í†µí•© ê´€ë¦¬)
  function resetGameState() {
    currentQuestionIndex = 0;
    score = 0;
    lives = 3;
    consecutiveCorrectAnswers = 0;
    scoreDisplay.textContent = `ì ìˆ˜: 0`;
    updateLivesDisplay();
    selectedOptionIndex = null;
    feedbackMessage.textContent = '';
    feedbackMessage.style.opacity = '0';
    nextButton.style.display = 'none';
    clearInterval(videoEndInterval);
    if (player) {
      player.stopVideo();
      player.loadVideoById({ videoId: 'vBfPzVd0y1s', startSeconds: 0 });
      currentVideoEndTime = -1;
    }

    // ìƒˆë¡œìš´ ê²Œì„ ì‹œì‘ ì‹œ ë¬¸ì œ ìˆœì„œ ì„ê¸°
    shuffledQuestions = shuffleArray([...questions]); // ì›ë³¸ ë°°ì—´ì„ í›¼ì†í•˜ì§€ ì•Šê¸° ìœ„í•´ ë³µì‚¬ í›„ ì„ê¸°
  }

  restartButton.addEventListener('click', () => {
    gameOverScreen.style.opacity = '0';
    gameOverScreen.style.transform = 'translateY(-20px)';
    setTimeout(() => {
      gameOverScreen.style.display = 'none';
      resetGameState(); // ë‹¤ì‹œ ì‹œì‘ ì‹œ ìƒíƒœ ì´ˆê¸°í™” ë° ë¬¸ì œ ì„ê¸°
      showScreen(startScreen);
    }, 500);
  });

  returnToMenuBtn.addEventListener('click', () => {
    const confirmLeave = confirm('í€´ì¦ˆ ì§„í–‰ ì¤‘ ë©”ë‰´ë¡œ ëŒì•„ê°€ë©´ í˜„ì¬ ì§„í–‰ ì •ë³´ê°€ ì´ˆê¸°í™”ë©ë‹ˆë‹¤. ê³„ì†í•˜ì‹œê² ì–´ìš”?');
    if (confirmLeave) {
      resetGameState(); // ë©”ë‰´ë¡œ ëŒì•„ê°ˆ ë•Œ ìƒíƒœ ì´ˆê¸°í™” ë° ë¬¸ì œ ì„ê¸°
      hideAllScreens();
      showScreen(startScreen);
    }
  });

  // --- ì´ˆê¸° ë¡œë“œ ì‹œ ì‹¤í–‰ ---
  loadSettings();
  populatePatchNotes(); // í˜ì´ì§€ ë¡œë“œ ì‹œ íŒ¨ì¹˜ë…¸íŠ¸ ë‚´ìš© ì±„ìš°ê¸° (ì •ë ¬ëœ ë°©ì‹ìœ¼ë¡œ)
  // ì²˜ìŒ í˜ì´ì§€ ë¡œë“œ ì‹œ ê²Œì„ ìƒíƒœ ì´ˆê¸°í™” ë° ë¬¸ì œ ì„ê¸°
  // ì´ë ‡ê²Œ í•˜ë©´ ì‹œì‘ ë²„íŠ¼ ëˆ„ë¥´ìë§ˆì ì²« ê²Œì„ ì„¸ì…˜ì´ ë°”ë¡œ ëœë¤ ìˆœì„œë¡œ ì¤€ë¹„ë¨
  resetGameState();
</script>
</body>
</html>